#!/usr/bin/env bash

backup="${HOME}/config.orig"

function link_dotfile {
	src=${1}
	dst=${2}

	if [ -e ${backup}/${dst} ];then
		rm -rf ${backup}/${dst}
	fi
	
	dst_dir=${backup}/${dst}
	dst_dir=${dst_dir%/*}
	if [ ! -e ${dst_dir} ];then
		mkdir -p ${dst_dir}
	fi

	if [ ! -e ${HOME}/${dst} ];then
		mv ${HOME}/${dst} ${backup}/${dst}
	fi
	ln -s ${PWD}/${src} ${HOME}/${dst}	
}

if [ ! -e ${backup} ]; then
	mkdir ${backup}
fi

for f in \
	.bashrc \
	.bash_profile \
	.fetchmailrc \
	.gitconfig \
	.gitignore \
	.mayu \
	.msmtprc \
	.Xdefaults \
	.Xresources \
	.xprofile \
	.xsession \
	.termcap \
	.tmux.conf \
	.screenrc \
	.mailcap \
	.msmtpqueue \
	.offlineimaprc \
	.procmailrc \
	.mutt \
	.vim \
	.vimrc \
	skk-dic \
	.infokey \
	.gvimrc \
	.ctags
do

	link_dotfile ${f} ${f}

done

case $OSTYPE in
	darwin*)
		link_dotfile .Xmodmap.mac .Xmodmap
		;;
	freebsd*)
		
		;;
	
	linux*)
		link_dotfile .Xmodmap.ubuntu .Xmodmap
		;;
	
	*)
		;;
esac

if [ ! -e ~/.config ];then
	mkdir ~/.config
fi
link_dotfile .config/awesome .config/awesome

mv ~/.gitignore ${backup}/.gitignore.orig
ln -s ${PWD}/global.gitignore ~/.gitignore
mv ~/.gitconfig ${backup}/.gitconfig.orig
ln -s ${PWD}/global.gitconfig ~/.gitconfig

echo "
.ssh \
.gnupg \
is not linked.
"
